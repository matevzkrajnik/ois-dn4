{"changed":false,"filter":false,"title":"moj.js","tooltip":"/moj.js","value":"\nvar baseUrl = 'https://rest.ehrscape.com/rest/v1';\nvar queryUrl = baseUrl + '/query';\n\nvar username = \"ois.seminar\";\nvar password = \"ois4fri\";\n\nvar mase = [];\nvar visine = [];\nvar steviloMas = 0;\nvar steviloVisin = 0;\nvar globalniItm = 0;\nvar stGrafov = 0;\nvar graf = 0;\n\n// TABELA ZA TESTIRANJE\n/*var tabelca = [ [\"Eritreja\", 19.85, \"ERI\"],\n\t\t\t\t\t[\"Nepal\", 20.55, \"NPL\"],\n\t\t\t\t\t[\"Afganistan\", 21.01, \"AFG\"],\n\t\t\t\t\t[\"Namibija\", 22.0, \"NAM\"],\n\t\t\t\t\t[\"Kirgizistan\", 22.90, \"KG\"],\n\t\t\t\t\t[\"Rusija\", 23.25, \"RUS\"],\n\t\t\t\t\t[\"Uzbekistan\", 23.80, \"UZB\"],\n\t\t\t\t\t[\"Nizozemska\", 24.14, \"NL\"],\n\t\t\t\t\t[\"Albanija\", 24.53, \"AL\"],\n\t\t\t\t\t[\"Slovenija\", 25.38, \"SVN\"],\n\t\t\t\t\t[\"Argentina\", 26.44, \"ARG\"],\n\t\t\t\t\t[\"Bahami\", 27.09, \"BHS\"], \n\t\t\t\t\t[\"ZDA\", 27.82, \"USA\"],\n\t\t\t\t\t[\"Samoa\", 28.34, \"WSM\"],\n\t\t\t\t\t[\"Tonga\", 32.90, \"TON\"] ];*/\n\t\t\t\t\t\nvar svetovniItm = [];\n\n$.getJSON(\"itmPoDrzavah.json\", function(json) {\n    console.log(json);\n    console.log( \"JSON Data: \" + json.drzave[2].long );\n    for(var i = 0; i < json.drzave.length; i++){\n    \tsvetovniItm[i] = [];\n    \tsvetovniItm[i][0] = json.drzave[i].long;\n    \tsvetovniItm[i][1] = json.drzave[i].value;\n    \tsvetovniItm[i][2] = json.drzave[i].name;\n    }\n    for(var i = 0; i < svetovniItm.length; i++){\n\t\tconsole.log(\"Država: \" + svetovniItm[i][0] + \", koda: \" + svetovniItm[i][2] + \", itm: \" + svetovniItm[i][1]);\n\t}\n});\n\n\nfunction getSessionId() {\n    var response = $.ajax({\n        type: \"POST\",\n        url: baseUrl + \"/session?username=\" + encodeURIComponent(username) +\n                \"&password=\" + encodeURIComponent(password),\n        async: false\n    });\n    return response.responseJSON.sessionId;\n}\n\n\nfunction kreirajEHRzaBolnika() {\n\tsessionId = getSessionId();\n\n\tvar ime = $(\"#kreirajIme\").val();\n\tvar priimek = $(\"#kreirajPriimek\").val();\n\tvar datumRojstva = $(\"#kreirajDatumRojstva\").val();\n\n\tif (!ime || !priimek || !datumRojstva || ime.trim().length == 0 || priimek.trim().length == 0 || datumRojstva.trim().length == 0) {\n\t\t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim, vnesite zahtevane podatke!</span>\");\n\t} else {\n\t\t$.ajaxSetup({\n\t\t    headers: {\"Ehr-Session\": sessionId}\n\t\t});\n\t\t$.ajax({\n\t\t    url: baseUrl + \"/ehr\",\n\t\t    type: 'POST',\n\t\t    success: function (data) {\n\t\t        var ehrId = data.ehrId;\n\t\t        var partyData = {\n\t\t            firstNames: ime,\n\t\t            lastNames: priimek,\n\t\t            dateOfBirth: datumRojstva,\n\t\t            partyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]\n\t\t        };\n\t\t        $.ajax({\n\t\t            url: baseUrl + \"/demographics/party\",\n\t\t            type: 'POST',\n\t\t            contentType: 'application/json',\n\t\t            data: JSON.stringify(partyData),\n\t\t            success: function (party) {\n\t\t                if (party.action == 'CREATE') {\n\t\t                    $(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Uspešno kreiran EHR '\" + ehrId + \"'.</span>\");\n\t\t                    console.log(\"Uspešno kreiran EHR '\" + ehrId + \"'.\");\n\t\t                    var seznamOpcij = document.getElementById(\"preberiEHROsebe\");\n\t\t                    seznamOpcij.options[seznamOpcij.length] = new Option(ime + \" \" + priimek, ehrId);\n\t\t                    var seznamOpcij2 = document.getElementById(\"preberiObstojeciVitalniZnak\");\n\t\t                    seznamOpcij2.options[seznamOpcij2.length] = new Option(ime + \" \" + priimek, ehrId);\n\t\t                    var seznamOpcij3 = document.getElementById(\"preberiEhrIdZaVitalneZnake\");\n\t\t                    seznamOpcij3.options[seznamOpcij3.length] = new Option(ime + \" \" + priimek, ehrId);\n\t\t                }\n\t\t            },\n\t\t            error: function(err) {\n\t\t            \t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");\n\t\t            \tconsole.log(JSON.parse(err.responseText).userMessage);\n\t\t            }\n\t\t        });\n\t\t    }\n\t\t});\n\t}\n}\n\n\nfunction dodajMeritveVitalnihZnakov() {\n\tsessionId = getSessionId();\n\n\tvar ehrId = $(\"#dodajVitalnoEHR\").val();\n\tvar datumInUra = $(\"#dodajVitalnoDatumInUra\").val();\n\tvar telesnaVisina = $(\"#dodajVitalnoTelesnaVisina\").val();\n\tvar telesnaTeza = $(\"#dodajVitalnoTelesnaTeza\").val();\n\tvar telesnaTemperatura = $(\"#dodajVitalnoTelesnaTemperatura\").val();\n\tvar sistolicniKrvniTlak = $(\"#dodajVitalnoKrvniTlakSistolicni\").val();\n\tvar diastolicniKrvniTlak = $(\"#dodajVitalnoKrvniTlakDiastolicni\").val();\n\tvar nasicenostKrviSKisikom = $(\"#dodajVitalnoNasicenostKrviSKisikom\").val();\n\n\tif (!ehrId || ehrId.trim().length == 0) {\n\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim, vnesite zahtevane podatke!</span>\");\n\t} else {\n\t\t$.ajaxSetup({\n\t\t    headers: {\"Ehr-Session\": sessionId}\n\t\t});\n\t\tvar podatki = {\n\t\t    \"ctx/language\": \"en\",\n\t\t    \"ctx/territory\": \"SI\",\n\t\t    \"ctx/time\": datumInUra,\n\t\t    \"vital_signs/height_length/any_event/body_height_length\": telesnaVisina,\n\t\t    \"vital_signs/body_weight/any_event/body_weight\": telesnaTeza,\n\t\t   \t\"vital_signs/body_temperature/any_event/temperature|magnitude\": telesnaTemperatura,\n\t\t    \"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",\n\t\t    \"vital_signs/blood_pressure/any_event/systolic\": sistolicniKrvniTlak,\n\t\t    \"vital_signs/blood_pressure/any_event/diastolic\": diastolicniKrvniTlak,\n\t\t    \"vital_signs/indirect_oximetry:0/spo2|numerator\": nasicenostKrviSKisikom\n\t\t};\n\t\tvar parametriZahteve = {\n\t\t    \"ehrId\": ehrId,\n\t\t    templateId: 'Vital Signs',\n\t\t    format: 'FLAT',\n\t\t};\n\t\t$.ajax({\n\t\t    url: baseUrl + \"/composition?\" + $.param(parametriZahteve),\n\t\t    type: 'POST',\n\t\t    contentType: 'application/json',\n\t\t    data: JSON.stringify(podatki),\n\t\t    success: function (res) {\n\t\t    \tconsole.log(res.meta.href);\n\t\t        $(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");\n\t\t    },\n\t\t    error: function(err) {\n\t\t    \t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");\n\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);\n\t\t    }\n\t\t});\n\t}\n}\n\nfunction generirajPodatke(){\n\tvar leto = steviloRand(1991, 2014);\n\tvar mesec = steviloRand2(1, 12);\n\t\n\tif(mesec == 2 && ((leto % 400) == 0)){\n\t\tvar dan = steviloRand2(1, 29);\n\t}\n\telse if(mesec == 2 && ((leto % 100) == 0)){\n\t\tvar dan = steviloRand2(1, 28);\n\t}\n\telse if(mesec == 2 && ((leto % 4) == 0)){\n\t\tvar dan = steviloRand2(1, 29);\n\t}\n\telse if(mesec == 2){\n\t\tvar dan = steviloRand2(1, 28);\n\t}\n\telse if(mesec == 1 || mesec == 3 || mesec == 5 || mesec == 7 || mesec == 8 || mesec == 10 || mesec == 12){\n\t\tvar dan = steviloRand2(1, 31);\n\t}\n\telse{\n\t\tvar dan = steviloRand2(1, 30);\n\t}\n\t\n\tvar ura = steviloRand2(0, 24);\n\tvar minute = steviloRand2(0, 59);\n\tvar visina = steviloRand(110, 220);\n\t\n\tif(visina < 150){\n\t\tvar teza = steviloRand(35, 70);\n\t}\n\telse{\n\t\tvar teza = steviloRand(70, 160);\n\t}\n\tvar temp = steviloRand3(34, 39);\n\tvar temperatura = Math.round(temp * 10 ) / 10;\n\tvar sisTlak = steviloRand(50, 200);\n\tvar diaTlak = steviloRand(40, sisTlak);\n\t\n\tvar visinaM = visina / 100;\n\tvar itm = teza / (visinaM * visinaM);\n\tif(itm < 26 && itm > 18.5){\n\t\tvar nasicenost = steviloRand(95, 99);\n\t}\n\telse{\n\t\tvar nasicenost = steviloRand(85, 94);\n\t}\n\t$(\"#dodajVitalnoDatumInUra\").val(leto + \"-\" + mesec + \"-\" + dan + \"T\" + ura + \":\" + minute);\n\t$(\"#dodajVitalnoTelesnaVisina\").val(visina);\n\t$(\"#dodajVitalnoTelesnaTeza\").val(teza);\n\t$(\"#dodajVitalnoTelesnaTemperatura\").val(temperatura);\n\t$(\"#dodajVitalnoKrvniTlakSistolicni\").val(sisTlak);\n\t$(\"#dodajVitalnoKrvniTlakDiastolicni\").val(diaTlak);\n\t$(\"#dodajVitalnoNasicenostKrviSKisikom\").val(nasicenost);\n}\n\nfunction steviloRand(min, max){\n\tvar stevilo = Math.floor(Math.random() * (max - min + 1)) + min;\n\treturn stevilo;\n}\n\nfunction steviloRand2(min, max){\n\tvar stevilo = Math.floor(Math.random() * (max - min + 1)) + min;\n\tif (stevilo < 10){\n\t\tstevilo = \"0\" + stevilo;\n\t}\n\treturn stevilo;\n}\n\nfunction steviloRand3(min, max){\n\tvar stevilo = Math.random() * (max - min + 1) + min;\n\treturn stevilo;\n}\n\nfunction napolniMase(karDobim){\n\tmase[steviloMas] = [];\n\tmase[steviloMas][0] = karDobim.time;\n\tmase[steviloMas][1] = karDobim.weight;\n\tsteviloMas++;\n}\n\nfunction preberiMeritveVitalnihZnakov() {\n\tsessionId = getSessionId();\t\n\n\tvar ehrId = $(\"#meritveVitalnihZnakovEHRid\").val();\n\tvar tip = $(\"#preberiTipZaVitalneZnake\").val();\n\n\tif (!ehrId || ehrId.trim().length == 0 || !tip || tip.trim().length == 0) {\n\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim, vnesite zahtevan podatek!\");\n\t} else {\n\t\t$(\"svg\").remove();\n\t\t$.ajax({\n\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",\n\t    \ttype: 'GET',\n\t    \theaders: {\"Ehr-Session\": sessionId},\n\t    \tsuccess: function (data) {\n\t\t\t\tvar party = data.party;\n\t\t\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(\"<br/><span>Pridobivanje podatkov za <b>'\" + tip + \"'</b> osebe <b>'\" + party.firstNames + \" \" + party.lastNames + \"'</b>.</span><br/><br/>\");\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t// TELESNA TEMPERATURA\n\t\t\t\tif (tip == \"telesna temperatura\") {\n\t\t\t\t\tvar AQL = \n\t\t\t\t\t\t\"select \" +\n    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/time/value as cas, \" +\n    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude as temperatura_vrednost, \" +\n    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/units as temperatura_enota \" +\n\t\t\t\t\t\t\"from EHR e[e/ehr_id/value='\" + ehrId + \"'] \" +\n\t\t\t\t\t\t\"contains OBSERVATION t[openEHR-EHR-OBSERVATION.body_temperature.v1] \";\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t    url: baseUrl + \"/query?\" + $.param({\"aql\": AQL}),\n\t\t\t\t\t    type: 'GET',\n\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},\n\t\t\t\t\t    success: function (res) {\n\t\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna temperatura</th></tr>\";\n\t\t\t\t\t\t        if(res){\n\t\t\t\t\t\t        \tvar rows = res.resultSet;\n\t\t\t\t\t\t        \tfor (var i in rows) {\n\t\t\t\t\t\t            \tresults += \"<tr><td>\" + rows[i].cas + \"</td><td class='text-right'>\" + rows[i].temperatura_vrednost + \" \" \t+ rows[i].temperatura_enota + \"</td>\";\n\t\t\t\t\t\t        \t}\n\t\t\t\t\t\t        \tresults += \"</table>\";\n\t\t\t\t\t\t        \t$(\"#rezultatMeritveVitalnihZnakov\").append(results);\n\t\t\t\t\t    \t} else {\n\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");\n\t\t\t\t\t    \t}\n\t\t\t\t\t    },\n\t\t\t\t\t    error: function() {\n\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");\n\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);\n\t\t\t\t\t    }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// TELESNA MASA\n\t\t\t\telse if (tip == \"telesna teža\") {\n\t\t\t\t\tgraf = 0;\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"weight\",\n\t\t\t\t\t    type: 'GET',\n\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},\n\t\t\t\t\t    success: function (res) {\n\t\t\t\t\t    \tif (res.length > 0) {\n\t\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna teža</th></tr>\";\n\t\t\t\t\t\t        for (var i in res) {\n\t\t\t\t\t\t            results += \"<tr><td>\" + res[i].time + \"</td><td class='text-right'>\" + res[i].weight + \" \" \t+ res[i].unit + \"</td>\";\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        results += \"</table>\";\n\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);\n\t\t\t\t\t    \t} else {\n\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");\n\t\t\t\t\t    \t}\n\t\t\t\t\t    },\n\t\t\t\t\t    error: function() {\n\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");\n\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);\n\t\t\t\t\t    }\n\t\t\t\t\t});\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// INDEKS TELESENE MASE\n\t\t\t\telse if(tip == \"itm\"){\n\t\t\t\t\tgraf = 0;\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"weight\",\n\t\t\t\t\t    type: 'GET',\n\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},\n\t\t\t\t\t    success: function (res) {\n\t\t\t\t\t    \tif (res.length > 0) {\n\t\t\t\t\t\t        for (var i in res) {\n\t\t\t\t\t\t        \tnapolniMase(res[i]);\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        \n\t\t\t\t\t\t        $.ajax({\n\t\t\t\t\t\t\t\t\turl: baseUrl + \"/view/\" + ehrId + \"/\" + \"height\",\n\t\t\t\t\t    \t\t\ttype: 'GET',\n\t\t\t\t\t    \t\t\theaders: {\"Ehr-Session\": sessionId},\n\t\t\t\t\t    \t\t\tsuccess: function (res) {\n\t\t\t\t\t    \t\t\t\tif (res.length > 0) {\n\t\t\t\t\t\t        \t\t\tfor (var i in res) {\n\t\t\t\t\t\t        \t\t\t\tvisine[steviloVisin] = [];\n\t\t\t\t\t\t        \t\t\t\tvisine[steviloVisin][0] = res[i].time;\n\t\t\t\t\t\t        \t\t\t\tvar visina = Math.round(res[i].height * 10 ) / 10 / 100;\n\t\t\t\t\t\t        \t\t\t\tvisine[steviloVisin][1] = visina;\n\t\t\t\t\t\t        \t\t\t\tsteviloVisin++;\n\t\t\t\t\t\t        \t\t\t}\n\t\t\t\t\t\t        \t\t\t\n\t\t\t\t\t\t        \t\t\tif(steviloMas > 0 && steviloVisin > 0){\n\t\t\t\t\t\t\t\t\t\t\t\tvar rezultat = [];\n\t\t\t\t\t\t\t\t\t\t\t\tvar steviloRezultatov = 0;\n\t\t\t\t\t\t\t\t\t\t\t\tvar izpis = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Indeks telesne mase</th></tr>\";\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t// SPREHOD PO MERITVAH MASE (za vsako skupno meritev izračunaj ITM)\n\t\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < steviloMas; i++){\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor(var j = 0; j < steviloVisin; j++){\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(mase[i][0] == visine[j][0]){\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trezultat[steviloRezultatov] = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trezultat[steviloRezultatov][0] = mase[i][0];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar itm = Math.round((mase[i][1] / (visine[j][1] * visine[j][1])) * 10 ) / 10;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trezultat[steviloRezultatov][1] = itm;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tizpis += \"<tr><td>\" + rezultat[steviloRezultatov][0] + \"</td><td class='text-right'>\" + rezultat[steviloRezultatov][1] + \" kg/m^2\" + \"</td>\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsteviloRezultatov++;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tizpis += \"</table>\";\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#rezultatMeritveVitalnihZnakov\").append(izpis);\n\t\t\t\t\t\t\t\t\t\t\t\tmase = [];\n\t\t\t\t\t\t\t\t\t\t\t\tvisine = [];\n\t\t\t\t\t\t\t\t\t\t\t\trezultat = [];\n\t\t\t\t\t\t\t\t\t\t\t\tsteviloMas = 0;\n\t\t\t\t\t\t\t\t\t\t\t\tsteviloVisin = 0;\n\t\t\t\t\t\t\t\t\t\t\t\tsteviloRezultatov = 0;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t    \t\t\t\t} else {\n\t\t\t\t\t    \t\t\t\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");\n\t\t\t\t\t    \t\t\t\t}\n\t\t\t\t\t    \t\t\t},\n\t\t\t\t\t    \t\t\terror: function() {\n\t\t\t\t\t    \t\t\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");\n\t\t\t\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);\n\t\t\t\t\t    \t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t    \t} else {\n\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");\n\t\t\t\t\t    \t}\n\t\t\t\t\t    },\n\t\t\t\t\t    error: function() {\n\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");\n\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);\n\t\t\t\t\t    }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// INDEKS TELESNE MASE - GRAF\n\t\t\t\tif (tip == \"itmGraf\") {\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"weight\",\n\t\t\t\t\t    type: 'GET',\n\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},\n\t\t\t\t\t    success: function (res) {\n\t\t\t\t\t    \tif (res.length > 0) {\n\t\t\t\t\t\t        for (var i in res) {\n\t\t\t\t\t\t        \tnapolniMase(res[i]);\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        \n\t\t\t\t\t\t        $.ajax({\n\t\t\t\t\t\t\t\t\turl: baseUrl + \"/view/\" + ehrId + \"/\" + \"height\",\n\t\t\t\t\t    \t\t\ttype: 'GET',\n\t\t\t\t\t    \t\t\theaders: {\"Ehr-Session\": sessionId},\n\t\t\t\t\t    \t\t\tsuccess: function (res) {\n\t\t\t\t\t    \t\t\t\tif (res.length > 0) {\n\t\t\t\t\t\t        \t\t\tfor (var i in res) {\n\t\t\t\t\t\t        \t\t\t\tvisine[steviloVisin] = [];\n\t\t\t\t\t\t        \t\t\t\tvisine[steviloVisin][0] = res[i].time;\n\t\t\t\t\t\t        \t\t\t\tvar visina = Math.round(res[i].height * 10 ) / 10 / 100;\n\t\t\t\t\t\t        \t\t\t\tvisine[steviloVisin][1] = visina;\n\t\t\t\t\t\t        \t\t\t\tsteviloVisin++;\n\t\t\t\t\t\t        \t\t\t}\n\t\t\t\t\t\t        \t\t\t\n\t\t\t\t\t\t        \t\t\tif(steviloMas > 0 && steviloVisin > 0){\n\t\t\t\t\t\t\t\t\t\t\t\tvar rezultat = [];\n\t\t\t\t\t\t\t\t\t\t\t\tvar steviloRezultatov = 0;\n\t\t\t\t\t\t\t\t\t\t\t\tvar izpis = \"<table class='table'><tr><th>Zadnje meritve</th></tr>\";\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t// SPREHOD PO MERITVAH MASE (za vsako skupno meritev izračunaj ITM)\n\t\t\t\t\t\t\t\t\t\t\t\tvar stGumbov = 0;\n\t\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < steviloMas; i++){\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor(var j = 0; j < steviloVisin; j++){\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(mase[i][0] == visine[j][0]){\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(stGumbov < 5){\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstGumbov++;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trezultat[steviloRezultatov] = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trezultat[steviloRezultatov][0] = mase[i][0];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar itm = Math.round((mase[i][1] / (visine[j][1] * visine[j][1])) * 10 ) / 10;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trezultat[steviloRezultatov][1] = itm;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar id = \"izbranaMeritevGraf\" + stGumbov + itm;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tizpis += \"<tr><td><button id='\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tizpis += id + \"'type='button' class='btn btn-primary btn-sm' onclick='izrisiGraf(this.id)'>\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tizpis += rezultat[steviloRezultatov][0];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tizpis += \"</button><span id='ujemanjeSporocilo\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tizpis += stGumbov + \"'></span>\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsteviloRezultatov++;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//document.getElementById(id).addEventListener(\"click\", nastaviID(id));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tgraf = 1;\n\t\t\t\t\t\t\t\t\t\t\t\tizpis += \"</table>\";\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(izpis);\n\t\t\t\t\t\t\t\t\t\t\t\tmase = [];\n\t\t\t\t\t\t\t\t\t\t\t\tvisine = [];\n\t\t\t\t\t\t\t\t\t\t\t\trezultat = [];\n\t\t\t\t\t\t\t\t\t\t\t\tsteviloMas = 0;\n\t\t\t\t\t\t\t\t\t\t\t\tsteviloVisin = 0;\n\t\t\t\t\t\t\t\t\t\t\t\tsteviloRezultatov = 0;\n\t\t\t\t\t\t\t\t\t\t\t\tstGumbov = 0;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t    \t\t\t\t} else {\n\t\t\t\t\t    \t\t\t\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");\n\t\t\t\t\t    \t\t\t\t}\n\t\t\t\t\t    \t\t\t},\n\t\t\t\t\t    \t\t\terror: function() {\n\t\t\t\t\t    \t\t\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");\n\t\t\t\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);\n\t\t\t\t\t    \t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t    \t} else {\n\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");\n\t\t\t\t\t    \t}\n\t\t\t\t\t    },\n\t\t\t\t\t    error: function() {\n\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");\n\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);\n\t\t\t\t\t    }\n\t\t\t\t\t});\n\t\t\t\t}\t\n\t    \t},\n\t    \terror: function(err) {\n\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");\n\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);\n\t    \t}\n\t\t});\n\t}\n}\n\nwindow.onresize = resize;\n\nfunction resize(){\n\tif(stGrafov > 0 && graf == 1){\n\t\tizrisiGraf();\n\t}\n}\n// ujemanja:\n//\t0 - procentualno ujemanje\n//\t1 - država ujemanja\n//\t2 - ITM države ujemanja\n//\t3 - koda države ujemanja \nfunction izrisiGraf(rezItm){\n\t//console.log(\"Globalni itm: \" + globalniItm);\n\t$(\"svg\").remove();\n\tvar mojItm = rezItm;\n\tvar itm = 0;\n\tif (mojItm !== undefined) {\n        // argument passed and not undefined\n        if(mojItm.length <= 4){\n\t\titm = rezItm;\n\t\tstGrafov++;\n\t\t}\n\t\telse{\n\t\t\titm = mojItm.substring(19, 23);\n\t\t\tvar stGumbov = mojItm.substring(18, 19);\n\t\t\tglobalniItm = itm;\n\t\t\tstGrafov++;\n\t\t}\n    } else {\n        // argument not passed or undefined\n        itm = globalniItm;\n    }\n\tconsole.log(mojItm);\n\t\n\t\n\tconsole.log(\"Stevilo gumbov: \" + stGumbov);\n\t\n\t//console.log(\"Stevilo grafov: \" + stGrafov);\n\t\n\tvar ujemanja = [];\n\tvar ujem = 0;\n\tvar tmp = 0;\n\tconsole.log(\"ITM: \" + itm);\n\tfor(var i = 0; i < svetovniItm.length; i++){\n\t\tujemanja[i] = [];\n\t\tif(itm < svetovniItm[i][1]){\n\t\t\tujem = itm / svetovniItm[i][1];\n\t\t\ttmp = Math.round(ujem * 1000 ) / 1000;\n\t\t\tujemanja[i][0] = tmp;\n\t\t\tujemanja[i][1] = svetovniItm[i][0];\n\t\t\tujemanja[i][2] = svetovniItm[i][1];\n\t\t\tujemanja[i][3] = svetovniItm[i][2];\n\t\t}\n\t\telse{\n\t\t\tujem = svetovniItm[i][1] / itm;\n\t\t\ttmp = Math.round(ujem * 1000 ) / 1000;\n\t\t\tujemanja[i][0] = tmp;\n\t\t\tujemanja[i][1] = svetovniItm[i][0];\n\t\t\tujemanja[i][2] = svetovniItm[i][1];\n\t\t\tujemanja[i][3] = svetovniItm[i][2];\n\t\t}\n\t}\n\tsortiraj(ujemanja);\n\tfor(var i = 0; i < ujemanja.length; i++){\n\t\tconsole.log(\"Ujemanje: \" + ujemanja[i][0]*100 + \" %, z državo: \" + ujemanja[i][1]);\n\t}\n\t$(\"#ujemanjeSporocilo\" + stGumbov).html(\"<span class='obvestilo label label-success fade-in'>ITM: \" + itm + \". Največje ujemanje z državo: \" + ujemanja[0][1] + \"</span>\");\n\tvar data = [];\n\t\t\n\tfor(var i = 0; i < svetovniItm.length; i++){\n\t\tdata.push({name: ujemanja[i][3], value: ujemanja[i][0], long: ujemanja[i][1]});\n\t}\n\t/*var data = [\n  \t\t{name: \"Locke\",    value: 0.04},\n  \t\t{name: \"Reyes\",    value: 0.08},\n  \t\t{name: \"Ford\",     value: 0.15},\n  \t\t{name: \"Jarrah\",   value: 0.16},\n  \t\t{name: \"Shephard\", value: 0.23},\n  \t\t{name: \"Kwon\",     value: 0.42}\n\t];*/\n\t\n\tvar w = window.innerWidth / 2 - 100;\n\tvar margin = {top: 20, right: 20, bottom: 70, left: 40},\n    width = w - margin.left - margin.right,\n    height = 400 - margin.top - margin.bottom;\n\n\t//var formatPercent = d3.format(\".0%\");\n\t\n\tvar x = d3.scale.ordinal()\n    \t.rangeRoundBands([0, width], .1);\n\n\tvar y = d3.scale.linear()\n    \t.range([height, 0]);\n\n\tvar xAxis = d3.svg.axis()\n    \t.scale(x)\n    \t.orient(\"bottom\");\n\n\tvar yAxis = d3.svg.axis()\n\t    .scale(y)\n\t    .orient(\"left\")\n\t    .ticks(10, \"%\");\n\t\n\t/*var tip = d3.tip()\n  \t\t.attr('class', 'd3-tip')\n  \t\t.offset([-10, 0])\n  \t\t.html(function(d) {\n    \t\treturn \"<strong>\" + d.name + \"</strong> <span style='color:blue'>\" + d.value + \"</span>\";\n  \t\t});\n  \t*/\n  \t\n\tvar svg = d3.select(\"#rezultatMeritveVitalnihZnakov\").append(\"svg\")\n\t    .attr(\"width\", width + margin.left + margin.right)\n\t    .attr(\"height\", height + margin.top + margin.bottom)\n\t  .append(\"g\")\n\t    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\t//svg.call(tip);\n\t\n\t  x.domain(data.map(function(d) { return d.long; }));\n\t  y.domain([0, d3.max(data, function(d) { return d.value; })]);\n\n\t  svg.append(\"g\")\n\t      .attr(\"class\", \"x axis\")\n\t      .attr(\"transform\", \"translate(0,\" + height + \")\")\n\t      .call(xAxis)\n\t      .selectAll(\"text\")  \n            .style(\"text-anchor\", \"end\")\n            .attr(\"dx\", \"-.8em\")\n            .attr(\"dy\", \".15em\")\n            .attr(\"transform\", function(d) {\n                return \"rotate(-65)\" \n            });\n\n\t  svg.append(\"g\")\n\t      .attr(\"class\", \"y axis\")\n\t      .call(yAxis)\n\t      svg.append(\"text\")\n        \t.attr(\"x\", (width / 2))             \n        \t.attr(\"y\", 0 - (margin.top / 2))\n        \t.attr(\"text-anchor\", \"middle\")  \n        \t.style(\"font-size\", \"14px\") \n        \t.style(\"text-decoration\", \"strong\")  \n        \t.text(\"Ujemanje indeksa telesne mase s povprečjem v državah po svetu\")\n\t    \t.append(\"text\")\n\t      .attr(\"transform\", \"rotate(-90)\")\n\t      .attr(\"y\", 6)\n\t      .attr(\"dy\", \".71em\")\n\n\n\t  svg.selectAll(\".bar\")\n\t      .data(data)\n\t    .enter().append(\"rect\")\n\t      .attr(\"class\", \"bar\")\n\t      .attr(\"x\", function(d) { return x(d.long); })\n\t      .attr(\"width\", x.rangeBand())\n\t      .attr(\"y\", function(d) { return y(d.value); })\n\t      .attr(\"height\", function(d) { return height - y(d.value); })\n\t\t  //.on('mouseover', tip.show)\n      \t  //.on('mouseout', tip.hide);\n      \n      /*svg.selectAll(\".bartext\")\n\t\t.data(data)\n\t\t.enter()\n\t\t.append(\"text\")\n\t\t.attr(\"class\", \"bartext\")\n\t\t.attr(\"text-anchor\", \"middle\")\n\t\t//.attr(\"fill\", \"white\")\n\t\t.attr(\"x\", function(d,i) {\n    \t\treturn x(d.name);\n\t\t})\n\t\t.attr(\"y\", function(d,i) {\n\t\t   return y(d.value);\n\t\t})\n\t\t.text(function(d){\n\t \t\treturn d.long;\n\t\t})\n\t\t.attr(\"transform\", \"rotate(-90)\");*/\n\t\t\n\tfunction type(d) {\n\t  d.value = +d.value;\n\t  return d;\n\t}\n}\n\nfunction sortiraj(tabela){\n\tfor(var i = 0; i < tabela.length-1 ; i++){\n\t\tvar maks = tabela[i][0];\n\t\tvar maksD = tabela[i][1];\n\t\tvar maksDi = tabela[i][2];\n\t\tvar maksK = tabela[i][3];\n\t\tvar iMaks = i;\n\t\t\n\t\tfor(var j = i+1; j < tabela.length; j++){\n\t\t\tif(tabela[j][0] > maks){\n\t\t\t\tmaks = tabela[j][0];\n\t\t\t\tmaksD = tabela[j][1];\n\t\t\t\tmaksDi = tabela[j][2];\n\t\t\t\tmaksK = tabela[j][3];\n\t\t\t\tiMaks = j;\n\t\t\t}\n\t\t}\n\t\ttabela[iMaks][0] = tabela[i][0];\n\t\ttabela[iMaks][1] = tabela[i][1];\n\t\ttabela[iMaks][2] = tabela[i][2];\n\t\ttabela[iMaks][3] = tabela[i][3];\n\t\ttabela[i][0] = maks;\n\t\ttabela[i][1] = maksD;\n\t\ttabela[i][2] = maksDi;\n\t\ttabela[i][3] = maksK;\n\t}\n}\n\n$(document).ready(function() {\n\t$('#preberiObstojeciEHR').change(function() {\n\t\t$(\"#preberiSporocilo\").html(\"\");\n\t\t$(\"#preberiEHRid\").val($(this).val());\n\t});\n\t$('#preberiPredlogoBolnika').change(function() {\n\t\t$(\"#kreirajSporocilo\").html(\"\");\n\t\tvar podatki = $(this).val().split(\",\");\n\t\t$(\"#kreirajIme\").val(podatki[0]);\n\t\t$(\"#kreirajPriimek\").val(podatki[1]);\n\t\t$(\"#kreirajDatumRojstva\").val(podatki[2]);\n\t});\n\t$('#preberiObstojeciVitalniZnak').change(function() {\n\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"\");\n\t\tvar podatki = $(this).val().split(\"|\");\n\t\t$(\"#dodajVitalnoEHR\").val(podatki[0]);\n\t\t$(\"#dodajVitalnoDatumInUra\").val(podatki[1]);\n\t\t$(\"#dodajVitalnoTelesnaVisina\").val(podatki[2]);\n\t\t$(\"#dodajVitalnoTelesnaTeza\").val(podatki[3]);\n\t\t$(\"#dodajVitalnoTelesnaTemperatura\").val(podatki[4]);\n\t\t$(\"#dodajVitalnoKrvniTlakSistolicni\").val(podatki[5]);\n\t\t$(\"#dodajVitalnoKrvniTlakDiastolicni\").val(podatki[6]);\n\t\t$(\"#dodajVitalnoNasicenostKrviSKisikom\").val(podatki[7]);\n\t});\n\t$('#preberiEhrIdZaVitalneZnake').change(function() {\n\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"\");\n\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(\"\");\n\t\t$(\"#meritveVitalnihZnakovEHRid\").val($(this).val());\n\t});\n\t$('#preberiEHROsebe').change(function() {\n\t\t$(\"#ehrIdKreiranega\").val($(this).val());\n\t});\n});","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":3600,"scrollleft":0,"selection":{"start":{"row":269,"column":23},"end":{"row":269,"column":23},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":256,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1419178061390}